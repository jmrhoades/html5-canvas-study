<!doctype>
<html>
<head>
	<meta charset="utf-8" />
	<style type="text/css">
	body {
	    background: black;
	}
	canvas {
	    position: absolute;
	    left: 0;
	    top: 0;
	    width: 100%;
	    height: 100%;
	}
	#menu {
	    position: absolute;
	    z-index: 99;
	}
	</style>
	<script type="text/javascript">

var wtf = new Object();

(function mySpirograph(){
    var width  = window.innerWidth;
    var height = window.innerHeight;
    var centerPoint = {x: width/2, y: height/2};
    var spiroLayer, circlesLayers;
    var curAngle;
    var zIndex = 0;
    var loop;
    var intervalId;
    var R,r,d;
    var mouseDown = false;
    var p = {}, p_old = {};
    var playStopButton, showHideButton;
    var hideCirc;
    var mouseCoor = {};
    var mover;

    wtf.drawBigCir = function (){
        circlesLayers.clearRect(0,0,width,height);
        circlesLayers.save()
        circlesLayers.translate(centerPoint.x, centerPoint.y)
        circlesLayers.strokeStyle = "white"
        circlesLayers.beginPath()
        circlesLayers.arc(0, 0, R, 0, Math.PI*2,true)
        circlesLayers.stroke()
        circlesLayers.restore()
    }

    wtf.alterValues = function (){
        R = parseInt(document.getElementById("R").value)
        r = parseInt(R * parseInt(document.getElementById("r").value)/100)
        d = parseInt(r * parseInt(document.getElementById("d").value)/100)

        circlesLayers.clearRect(0,0,width,height);
        wtf.drawBigCir();
    }

    window.onload = function(){
        spiroLayer = canvasFactory();
        circlesLayers = canvasFactory();

        wtf.alterValues()

        mover = document.getElementById('mover');

        mover.style.left = centerPoint.x - R - 32;
        mover.style.top = centerPoint.y - R;

        mover.onmousedown = dragCenter.startDrag;

    }

    function canvasFactory(){
        var canvas = document.createElement("canvas");
        canvas.width  = width;
        canvas.height = height;
        canvas.style.zIndex = zIndex;
        zIndex++;

        document.body.appendChild(canvas);

        return canvas.getContext("2d");
    }

    var dragCenter = {

        iniMousePos:    {},
        startPos:       {},
        dragging:       null,

        startDrag: function (e) {
            dragCenter.startPos.x = this.offsetLeft;
            dragCenter.startPos.y = this.offsetTop;
            dragCenter.dragging = this;
            this.className += ' dragged';

            dragCenter.iniMousePos.x = e.clientX;
            dragCenter.iniMousePos.y = e.clientY;

            document.addEventListener('mousemove',  dragCenter.drag     , false);

            document.addEventListener('mouseup',    dragCenter.release  , false);

            return false;
        },

        drag: function (e) {
            var x = e.clientX - dragCenter.iniMousePos.x;
            var y = e.clientY - dragCenter.iniMousePos.y;

            dragCenter.setPos(x, y);
            wtf.drawBigCir();
            
            return false;
        },

        release: function () {
            document.removeEventListener('mousemove', dragCenter.drag, false);
            document.removeEventListener('mouseup', dragCenter.release, false);
            dragCenter.dragging.className = dragCenter.dragging.className.replace(/ dragged/, '');
            dragCenter.dragging = null;
        },

        setPos: function (x, y){
            dragCenter.dragging.style.left = dragCenter.startPos.x + x + 'px';
            dragCenter.dragging.style.top = dragCenter.startPos.y + y + 'px';

            centerPoint.x = dragCenter.startPos.x + x + R + 20;
            centerPoint.y = dragCenter.startPos.y + y + R;
        }
    };

}())

	</script>
</head>

<body>
    <div id="menu">
        <input id="R" type="range" min="10" max="300" value="100" onchange="wtf.alterValues()"/>
        <input id="r" type="range" min="10" max="90" value="52" onchange="wtf.alterValues()"/>
        <input id="d" type="range" min="0" max="100" value="75" onchange="wtf.alterValues()"/>

        <img id="play_stop_button" onclick="wtf.toggleAnimation()" src="../spirograph_images/play.png" />
        <img id="show_hide_button" onclick="wtf.toggleCircs()" src="../spirograph_images/hide_circ.png" />

    </div>
    <div id="mover" style="background: url(../spirograph_images/move.png);position: absolute; width: 32px; height: 32px; z-index: 9999; display: inline;"/>
</body>
</html>
