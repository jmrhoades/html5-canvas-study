<!doctype>
<html>
<head>
	<meta charset="utf-8" />
	<style type="text/css">
	body {
	    background: black;
	}
	canvas {
	    position: absolute;
	    left: 0;
	    top: 0;
	    width: 100%;
	    height: 100%;
	}
	#menu {
	    position: absolute;
	    z-index: 99;
	}
	</style>
	<script type="text/javascript">

var wtf = new Object();

(function mySpirograph(){
    var width  = window.innerWidth;
    var height = window.innerHeight;
    var centerPoint = {x: width/2, y: height/2};
    var spiroLayer, circlesLayers;
    var curAngle;
    var zIndex = 0;
    var loop;
    var intervalId;
    var R,r,d;
    var mouseDown;
    var p = {}, p_old = {};
    var playStopButton, showHideButton;
    var hideCirc;

    wtf.init = function() {
        spiroLayer.clearRect(0,0,width,height);
        circlesLayers.clearRect(0,0,width,height);
    }

    wtf.drawBigCir = function (){
        circlesLayers.save()
        circlesLayers.translate(centerPoint.x, centerPoint.y)
        circlesLayers.strokeStyle = "white"
        circlesLayers.beginPath()
        circlesLayers.arc(0, 0, R, 0, Math.PI*2,true)
        circlesLayers.stroke()
        circlesLayers.restore()
    }

    wtf.drawLittleCir = function (angle){
        curAngle = angle;

        circlesLayers.save()
        circlesLayers.translate(centerPoint.x, centerPoint.y)
        circlesLayers.strokeStyle = "white"
        circlesLayers.rotate(angle)
        circlesLayers.beginPath()
        circlesLayers.translate(R-r, 0)
        circlesLayers.arc(0, 0, r, 0, Math.PI*2,true)
        circlesLayers.stroke()
        circlesLayers.restore()

        circlesLayers.save()
        circlesLayers.strokeStyle = "red"
        circlesLayers.translate(centerPoint.x, centerPoint.y)

        circlesLayers.beginPath();
        circlesLayers.arc(p.x, p.y, 1, 0, Math.PI*2, true)
        circlesLayers.stroke()

        circlesLayers.restore()
    }

    wtf.drawSpiro = function(angle){
        spiroLayer.save()
        spiroLayer.translate(centerPoint.x, centerPoint.y)

        spiroLayer.strokeStyle = "#aaa";

        spiroLayer.beginPath()
        spiroLayer.moveTo(p_old.x, p_old.y);
        spiroLayer.lineTo(p.x, p.y);
        spiroLayer.stroke()

        spiroLayer.restore()
    }

    wtf.redrawCirs = function (angle){
        p_old.x = p.x
        p_old.y = p.y

        p.x = (R-r)*Math.cos(angle) + d*Math.cos(-((R-r)/r)*angle);
        p.y = (R-r)*Math.sin(angle) + d*Math.sin(-((R-r)/r)*angle);

        circlesLayers.clearRect(0,0,width,height);
        if(!hideCirc){
            wtf.drawBigCir();
            wtf.drawLittleCir(angle);
        }
        wtf.drawSpiro(angle);
    }

    wtf.animateCirs = function (){
        if(!mouseDown){
            wtf.redrawCirs(Math.PI/30*loop);
            loop++;
        }
    }

    wtf.stopAnimation = function (){
        clearInterval(intervalId);
        intervalId = false
    }
    
    wtf.playAnimation = function (){
        intervalId = setInterval("wtf.animateCirs()", 10);
    }

    wtf.toggleAnimation = function (){
        if(intervalId){
            playStopButton.src = 'spirograph_images/play.png'
            wtf.stopAnimation();

            wtf.drawBigCir();
            wtf.drawLittleCir(curAngle);
        }
        else {
            playStopButton.src = 'spirograph_images/stop.png'
            wtf.playAnimation()
        }
    }

    wtf.toggleCircs = function (){
        if(hideCirc){
            showHideButton.src = 'spirograph_images/hide_circ.png'
            hideCirc = false;
        }
        else {
            showHideButton.src = 'spirograph_images/show_circ.png'
            hideCirc = true;
        }
    }

    wtf.alterValues = function (){
        R = parseInt(document.getElementById("R").value)
        r = parseInt(R * parseInt(document.getElementById("r").value)/100)
        d = parseInt(r * parseInt(document.getElementById("d").value)/100)

        circlesLayers.clearRect(0,0,width,height);
        wtf.drawBigCir();
        wtf.drawLittleCir(curAngle);
    }

    wtf.moveCircs = function (){
        
    }

    window.onload = function(){
        spiroLayer = canvasFactory();
        circlesLayers = canvasFactory();

        window.addEventListener('mousedown', function(){
            mouseDown = true;
        }, false);

        window.addEventListener('mouseup', function(){
            mouseDown = false;
        }, false);

        playStopButton = document.getElementById('play_stop_button');
        showHideButton = document.getElementById('show_hide_button');

        wtf.alterValues()

        loop = 0;
        hideCirc = false;
    }

    function canvasFactory(){
        var canvas = document.createElement("canvas");
        canvas.width  = width;
        canvas.height = height;
        canvas.style.zIndex = zIndex;
        zIndex++;

        document.body.appendChild(canvas);

        return canvas.getContext("2d");
    }

}())

	</script>
</head>

<body>
    <div id="menu">
        <input id="R" type="range" min="10" max="300" value="100" onchange="wtf.alterValues()"/>
        <input id="r" type="range" min="10" max="90" value="52" onchange="wtf.alterValues()"/>
        <input id="d" type="range" min="0" max="100" value="75" onchange="wtf.alterValues()"/>

        <img id="play_stop_button" onclick="wtf.toggleAnimation()" src="spirograph_images/play.png" />
        <img id="show_hide_button" onclick="wtf.toggleCircs()" src="spirograph_images/hide_circ.png" />
    </div>
</body>
</html>
